[
  {
    "objectID": "age_reference_plots.html",
    "href": "age_reference_plots.html",
    "title": "Age reference plots",
    "section": "",
    "text": "source\n\nAgeRefPlot\n\n AgeRefPlot (data:pandas.core.frame.DataFrame, val_col:str,\n             age_col:str='age_at_research_stage', sex_col:str='sex',\n             sex:Union[int,NoneType]=None,\n             val_color:Union[str,NoneType]=None,\n             ax_main:Union[matplotlib.axes._axes.Axes,NoneType]=None,\n             ax_agehist:Union[matplotlib.axes._axes.Axes,NoneType]=None,\n             ax_valhist:Union[matplotlib.axes._axes.Axes,NoneType]=None,\n             age_bins:Union[numpy.ndarray,NoneType]=None,\n             val_bins:Union[numpy.ndarray,NoneType]=None,\n             linear_fit:bool=True, lowess:bool=False,\n             top_disp_perc:float=99, bottom_disp_perc:float=1,\n             percentiles_type:str='summary', robust:bool=True,\n             scale:float=1.0, transform:Union[Callable,NoneType]=None,\n             make_fig:bool=True)\n\nInitializes the AgeRefPlot class.\nArgs: data (pd.DataFrame): A pandas DataFrame containing the data. val_col (str): The name of the value column in the DataFrame. age_col (str): The name of the age column in the DataFrame. sex_col (str): The name of the sex column in the DataFrame. sex (Optional[int], optional): The sex to filter the data by. 0 for females and 1 for males. Defaults to None. val_color (Optional[str], optional): The color to use for the value plot. Defaults to None. ax_main (Optional[plt.Axes], optional): The main axis for the plot. Defaults to None. ax_agehist (Optional[plt.Axes], optional): The axis for the age histogram. Defaults to None. ax_valhist (Optional[plt.Axes], optional): The axis for the value histogram. Defaults to None. age_bins (Optional[np.ndarray], optional): The age bins for the histograms. Defaults to None. val_bins (Optional[np.ndarray], optional): The value bins for the histograms. Defaults to None. linear_fit (bool, optional): Whether to perform a linear fit on the data. Defaults to True. lowess (bool, optional): Whether to perform lowess smoothing on the data. Defaults to False. top_disp_perc (float, optional): The top percentile to use for display. Defaults to 99. bottom_disp_perc (float, optional): The bottom percentile to use for display. Defaults to 1. percentiles_type (str, optional): The type of percentiles to use. Must be one of [‘summary’, ‘1-percent intervals’, ‘5-percent intervals’, ‘10-percent intervals’]. Defaults to ‘summary’. robust (bool, optional): Whether to use a robust regression method (HuberRegressor) instead of ordinary least squares for linear_fit. Defaults to True. scale (float, optional): The scaling factor for the value column. Defaults to 1. transform (Optional[Callable], optional): The transformation function to apply to the value column. Defaults make_fig (bool, optional): Whether to create a new figure if axes are not provided. Defaults to True.\n\ndata = generate_synthetic_data(n=1000)\n\n\nrefplot = AgeRefPlot(data, \"val1\")\nrefplot.plot()\n\n\n\n\n\nsource\n\n\nGenderAgeRefPlot\n\n GenderAgeRefPlot (data:pandas.core.frame.DataFrame, val_col:str,\n                   age_col:str='age_at_research_stage', sex_col:str='sex',\n                   age_bins:Union[numpy.ndarray,NoneType]=None,\n                   val_bins:Union[numpy.ndarray,NoneType]=None,\n                   linear_fit:bool=True, lowess:bool=False,\n                   top_disp_perc:float=99, bottom_disp_perc:float=1,\n                   percentiles_type:str='summary', robust:bool=True,\n                   scale:float=1.0,\n                   transform:Union[Callable,NoneType]=None)\n\nInitializes the GenderAgeRefPlot class.\nArgs: data (pd.DataFrame): The input data containing age, value, and gender columns. val_col (str): The name of the value column in the data. age_col (str): The name of the age column in the DataFrame. sex_col (str): The name of the sex column in the DataFrame. age_bins (np.ndarray, optional): An array of age bin edges. val_bins (np.ndarray, optional): An array of value bin edges. linear_fit (bool, optional): Whether to fit a linear regression line. Defaults to True. lowess (bool, optional): Whether to fit a LOWESS curve. Defaults to False. top_disp_perc (float, optional): The top percentile for data display. Defaults to 99. bottom_disp_perc (float, optional): The bottom percentile for data display. Defaults to 1. percentiles_type (str, optional): The type of percentile calculation. Defaults to ‘summary’. robust (bool, optional): Whether to use a robust linear regression. Defaults to True. scale (float, optional): The scaling factor for the data. Defaults to 1. transform (Callable, optional): An optional function to apply to the data. Defaults to None.\n\ngender_refplots = GenderAgeRefPlot(data, \"val1\")\ngender_refplots.plot()"
  },
  {
    "objectID": "basic_plots.html",
    "href": "basic_plots.html",
    "title": "Basic plots",
    "section": "",
    "text": "source\n\nhist_ecdf_plots\n\n hist_ecdf_plots (data:pandas.core.frame.DataFrame, col:str,\n                  feature_str:Union[str,NoneType]=None,\n                  gender_col:str='sex')\n\nPlots histograms and empirical cumulative distribution functions (ECDFs) from a DataFrame for a specific column.\nArgs: data: The input DataFrame containing the data to plot. col: The column name to plot. feature_str: The title of the plot. If not provided, the column name will be used. gender_col: The column name indicating sex (default is ‘sex’ - female:0; male:1).\nReturns: None\n\ndata = generate_synthetic_data(n=1000)\nhist_ecdf_plots(data=data, col=\"val1\")"
  },
  {
    "objectID": "blandaltman_plots.html",
    "href": "blandaltman_plots.html",
    "title": "Bland-Altman plots",
    "section": "",
    "text": "source\n\nbland_altman_triple_plot\n\n bland_altman_triple_plot (data:pandas.core.frame.DataFrame, m1_col:str,\n                           m2_col:str, feature_str:str='')\n\nGenerates a triple plot consisting of a scatter correlation plot, Bland-Altman plot, and a percentage Bland-Altman plot.\nArgs: data (pd.DataFrame): A pandas DataFrame containing the data. m1_col (str): The name of the first measurement column in the DataFrame. m2_col (str): The name of the second measurement column in the DataFrame. feature_str (str, optional): A string to include in the title of the plots. Defaults to ““.\nReturns: None\n\ndata = generate_synthetic_data(n=1000)\n\nbland_altman_triple_plot(data=data, m1_col=\"val1\",m2_col=\"val2\")"
  },
  {
    "objectID": "config.html",
    "href": "config.html",
    "title": "Config",
    "section": "",
    "text": "source\n\ngenerate_synthetic_data\n\n generate_synthetic_data (n:int=1000)\n\nGenerates a sample DataFrame containing age, gender, and value data.\nArgs: n: The number of rows in the generated DataFrame.\nReturns: A pandas DataFrame with columns ‘age’, ‘gender’, and ‘val’.\n\nsource\n\n\ngenerate_synthetic_data_like\n\n generate_synthetic_data_like (df:pandas.core.frame.DataFrame, n:int=1000,\n                               random_seed:int=42)\n\nGenerate a sample DataFrame containing the same columns as df, but with random data.\nArgs:\ndf: The DataFrame whose columns should be used.\nn: The number of rows in the generated DataFrame.\nReturns: A pandas DataFrame with the same columns as df.\n\ndata = generate_synthetic_data()\ndata.head()\n\n\n\n\n\n  \n    \n      \n      date_of_research_stage\n      age_at_research_stage\n      sex\n      val1\n      val2\n    \n    \n      participant_id\n      \n      \n      \n      \n      \n    \n  \n  \n    \n      0\n      2021-05-29\n      69.788555\n      1\n      162.270810\n      82.273910\n    \n    \n      1\n      2020-12-13\n      36.289947\n      1\n      125.240476\n      71.164810\n    \n    \n      2\n      2021-12-30\n      61.501970\n      1\n      116.044417\n      68.405992\n    \n    \n      3\n      2020-06-15\n      46.299262\n      0\n      84.440308\n      56.924759\n    \n    \n      4\n      2020-12-14\n      70.127055\n      1\n      120.693921\n      69.800843\n    \n  \n\n\n\n\n\ngenerate_synthetic_data_like(data.head(), n=5)\n\n\n\n\n\n  \n    \n      \n      date_of_research_stage\n      age_at_research_stage\n      sex\n      val1\n      val2\n    \n    \n      participant_id\n      \n      \n      \n      \n      \n    \n  \n  \n    \n      0\n      2021-12-30\n      46.299262\n      1\n      84.440308\n      82.273910\n    \n    \n      1\n      2020-06-15\n      36.289947\n      1\n      162.270810\n      69.800843\n    \n    \n      2\n      2020-12-14\n      61.501970\n      1\n      120.693921\n      71.164810\n    \n    \n      3\n      2020-12-13\n      69.788555\n      1\n      116.044417\n      68.405992\n    \n    \n      4\n      2021-05-29\n      70.127055\n      0\n      125.240476\n      56.924759"
  },
  {
    "objectID": "date_plots.html",
    "href": "date_plots.html",
    "title": "Dates plots",
    "section": "",
    "text": "source\n\ndates_dist_plot\n\n dates_dist_plot (df:pandas.core.frame.DataFrame, col:str,\n                  sampling_period:str='W-MON',\n                  ax:Union[Collection,NoneType]=None,\n                  date_col:str='collection_date',\n                  ylim:Union[Tuple[float,float],NoneType]=None,\n                  quantiles:Union[List[Tuple[float,str]],NoneType]=None)\n\nCreates a scatter plot of data points and their statistics based on a specified sampling period.\nArgs: df (pd.DataFrame): The input DataFrame containing the data. col (str): The column name in the DataFrame to plot. sampling_period (str, optional): The frequency to resample the data. Defaults to ‘W-MON’. ax (Optional[Axes], optional): A matplotlib axes object to plot on. Defaults to None. date_col (str, optional): The name of the date column in the DataFrame. Defaults to ‘collection_date’. ylim (Optional[Tuple[float, float]], optional): A tuple defining the y-axis limits. Defaults to None. quantiles (Optional[List[Tuple[float, str]]], optional): A list of tuples containing quantiles and their labels. Defaults to [(0.1, “10%”), (0.9, “90%”)].\n\ndata = generate_synthetic_data()\ndata.head()\n\n\n\n\n\n  \n    \n      \n      date_of_research_stage\n      age_at_research_stage\n      sex\n      val1\n      val2\n    \n    \n      participant_id\n      \n      \n      \n      \n      \n    \n  \n  \n    \n      0\n      2022-12-01\n      57.777073\n      1\n      150.216212\n      56.936487\n    \n    \n      1\n      2020-07-29\n      53.770724\n      1\n      117.603875\n      47.152785\n    \n    \n      2\n      2020-09-30\n      51.326393\n      1\n      97.928950\n      41.250308\n    \n    \n      3\n      2022-05-06\n      61.217276\n      0\n      105.169939\n      41.422605\n    \n    \n      4\n      2021-06-29\n      45.835170\n      0\n      54.735540\n      26.292285\n    \n  \n\n\n\n\n\ndates_dist_plot(data, col=\"val1\", date_col=\"date_of_research_stage\")"
  },
  {
    "objectID": "data_loader.html",
    "href": "data_loader.html",
    "title": "Data loader",
    "section": "",
    "text": "source\n\nDataLoader\n\n DataLoader (dataset:str, cohort:str='10k',\n             base_path:str='/home/ec2-user/studies/',\n             age_sex_dataset:str='Population_Characteristics',\n             unique_index:bool=False, valid_dates:bool=False,\n             valid_stage:bool=False, errors:str='raise')\n\nClass to load multiple tables from a dataset and allows to easily access their fields.\nArgs:\ndataset (str): The name of the dataset to load.\ncohort (str, optional): The name of the cohort within the dataset. Defaults to '10k'.\nbase_path (str, optional): The base path where the data is stored. Defaults to '/home/ec2-user/studies'.\nage_sex_dataset (str, optional): The name of the dataset to use for computing age and sex. Defaults to 'Population_Characteristics'.\nunique_index (bool, optional): Whether to ensure the index of the data is unique. Defaults to False.\nvalid_dates (bool, optional): Whether to ensure that all timestamps in the data are valid dates. Defaults to False.\nvalid_stage (bool, optional): Whether to ensure that all research stages in the data are valid. Defaults to False.\nerrors (str, optional): Whether to raise an error or issue a warning if missing data is encountered.\n    Possible values are 'raise' and 'warn'. Defaults to 'raise'.\nAttributes:\ndict (pd.DataFrame): The data dictionary for the dataset, containing information about each field.\ndfs (dict): A dictionary of dataframes, one for each table in the dataset.\nfields (list): A list of all fields in the dataset.\ndataset (str): The name of the dataset being used.\ncohort (str): The name of the cohort being used.\nbase_path (str): The base path where the data is stored.\nage_sex_dataset (str): The name of the dataset being used to compute age and sex.\nunique_index (bool): Whether to ensure the index of the data is unique.\nvalid_dates (bool): Whether to ensure that all timestamps in the data are valid dates.\nvalid_stage (bool): Whether to ensure that all research stages in the data are valid.\nerrors (str): Whether to raise an error or issue a warning if missing data is encountered.\nUse the dataset name to load the dataset. It may contain multiple tables. Age / sex will be added to the data by default. The default base_path is set to work on the research platform.\n\ndl = DataLoader('Fundus', base_path='examples/', errors='warn')\ndl\n\nDataLoader for Fundus with\n78 fields\n2 tables: ['fundus', 'age_sex']\n\n\nThe data dictionary of the dataset displays the description of each field.\n\ndl.dict.head(3)\n\n\n\n\n\n  \n    \n      \n      field_string\n      description_string\n      parent_dataframe\n      relative_location\n      value_type\n      units\n      sampling_rate\n      item_type\n      array\n      cohorts\n      data_type\n      debut\n      pandas_dtype\n    \n    \n      tabular_field_name\n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n    \n  \n  \n    \n      fundus_image_left\n      Fundus image (left)\n      Fundus image (left)\n      NaN\n      fundus.parquet\n      Text\n      None\n      NaN\n      Bulk\n      Single\n      10K\n      image\n      2021-02-17\n      string\n    \n    \n      fundus_image_right\n      Fundus image (right)\n      Fundus image (right)\n      NaN\n      fundus.parquet\n      Text\n      None\n      NaN\n      Bulk\n      Single\n      10K\n      image\n      2021-02-17\n      string\n    \n    \n      collection_date\n      Collection date (YYYY-MM-DD)\n      Collection date (YYYY-MM-DD)\n      NaN\n      fundus.parquet\n      Date\n      Time\n      NaN\n      Data\n      Single\n      10K\n      tabular\n      2021-02-17\n      datetime64[ns]\n    \n  \n\n\n\n\n\ndl.dfs['fundus'].head(3)\n\n\n\n\n\n  \n    \n      \n      \n      \n      \n      fundus_image_left\n      fundus_image_right\n      collection_date\n      artery_average_width_left\n      artery_average_width_right\n      artery_distance_tortuosity_left\n      artery_distance_tortuosity_right\n      artery_fractal_dimension_left\n      artery_fractal_dimension_right\n      artery_squared_curvature_tortuosity_left\n      ...\n      vein_fractal_dimension_left\n      vein_fractal_dimension_right\n      vein_squared_curvature_tortuosity_left\n      vein_squared_curvature_tortuosity_right\n      vein_tortuosity_density_left\n      vein_tortuosity_density_right\n      vein_vessel_density_left\n      vein_vessel_density_right\n      vessel_density_left\n      vessel_density_right\n    \n    \n      participant_id\n      cohort\n      research_stage\n      array_index\n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n      \n    \n  \n  \n    \n      0\n      10k\n      00_00_visit\n      0\n      /path/to/file\n      /path/to/file\n      2022-11-16\n      18430.284751\n      19038.547771\n      3.668175\n      3.271147\n      1.355673\n      1.343602\n      40.648267\n      ...\n      1.410553\n      1.403108\n      14.208195\n      6.098432\n      0.700187\n      0.698546\n      0.046645\n      0.045864\n      0.080377\n      0.078671\n    \n    \n      1\n      10k\n      00_00_visit\n      0\n      /path/to/file\n      /path/to/file\n      2022-06-30\n      17315.398780\n      19099.489575\n      2.095461\n      1.634782\n      1.368933\n      1.363413\n      24.253169\n      ...\n      1.387527\n      1.332864\n      8.999069\n      8.702682\n      0.740806\n      0.708911\n      0.037896\n      0.046853\n      0.074197\n      0.064578\n    \n    \n      2\n      10k\n      00_00_visit\n      0\n      /path/to/file\n      /path/to/file\n      2021-10-05\n      15375.866993\n      19855.576862\n      2.776472\n      2.747015\n      1.360404\n      1.362699\n      9.742353\n      ...\n      1.411881\n      1.408791\n      13.119227\n      9.936669\n      0.627281\n      0.675100\n      0.053022\n      0.048063\n      0.079515\n      0.082102\n    \n  \n\n3 rows × 76 columns\n\n\n\nAll availbale fields (columns) in all tables can be listed.\n\ndl.fields[:5]\n\n['artery_squared_curvature_tortuosity_right',\n 'fundus_image_binary_vein_segmentation_right',\n 'timezone',\n 'fundus_image_quality_good_score_left',\n 'fundus_image_quality_prediction_left']\n\n\nAccess any of the fields (e.g., vein_average_width_right, age) or indices (e.g., research_stage) from any of the tables via the data loader API.\n\ndl[['research_stage', 'vein_average_width_right', 'age', 'sex']]\n\n\n\n\n\n  \n    \n      \n      \n      \n      \n      vein_average_width_right\n      age\n      sex\n      research_stage\n    \n    \n      participant_id\n      cohort\n      research_stage\n      array_index\n      \n      \n      \n      \n    \n  \n  \n    \n      0\n      10k\n      00_00_visit\n      0\n      18436.428634\n      43.5\n      0\n      00_00_visit\n    \n    \n      1\n      10k\n      00_00_visit\n      0\n      18888.160314\n      53.7\n      1\n      00_00_visit\n    \n    \n      2\n      10k\n      00_00_visit\n      0\n      19013.865043\n      26.2\n      0\n      00_00_visit\n    \n    \n      3\n      10k\n      00_00_visit\n      0\n      18809.012493\n      44.6\n      1\n      00_00_visit\n    \n    \n      4\n      10k\n      00_00_visit\n      0\n      19428.986690\n      50.3\n      0\n      00_00_visit\n    \n  \n\n\n\n\nAccess time series or bulk data that is stored separately for each sample via the data loader API. In the following example, the data loader retrieves the relative path of each sample’s bulk file from the main table (where it is stored in the field fundus_image_left), converts it to an absolute path, and loads the file. This is repeated for 3 samples and returned as a list. In the case of parquet DataFrames, there is no need to define the load_func and the results are concatenated by deafult.\n\nfrom PIL import Image\n\n\ndl.load_sample_data('fundus_image_left', [0, 1, 2], load_func=Image.open, concat=False)\n\n[<PIL.PngImagePlugin.PngImageFile image mode=RGBA size=25x25>,\n <PIL.PngImagePlugin.PngImageFile image mode=RGBA size=25x25>,\n <PIL.PngImagePlugin.PngImageFile image mode=RGBA size=25x25>]"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "pheno-utils",
    "section": "",
    "text": "Viz functions, loaders, mergers.\nWORK IN PROGRESS"
  },
  {
    "objectID": "index.html#install",
    "href": "index.html#install",
    "title": "pheno-utils",
    "section": "Install",
    "text": "Install\npip install pheno_utils"
  },
  {
    "objectID": "index.html#how-to-use",
    "href": "index.html#how-to-use",
    "title": "pheno-utils",
    "section": "How to use",
    "text": "How to use\nExamples:\n\ndata = generate_synthetic_data(n=1000)\nhist_ecdf_plots(data=data, col=\"val1\")\n\nNameError: name 'hist_ecdf_plots' is not defined\n\n\n\nage_refplots = GenderAgeRefPlot(data, \"val1\")\nage_refplots.plot()"
  }
]